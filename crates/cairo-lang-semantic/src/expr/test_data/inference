//! > Test return type inference

//! > test_function_name
test_function_diagnostics

//! > function
fn foo() -> Option::<felt> {
    Option::Some(5)
}

//! > function_name
foo

//! > module_code

//! > expected_diagnostics

//! > ==========================================================================

//! > Test queue inference

//! > test_function_name
test_function_diagnostics

//! > function
fn foo() {
    let mut q = queue_new();
    queue_append(ref q, 1)
}

//! > function_name
foo

//! > module_code

//! > expected_diagnostics

//! > ==========================================================================

//! > Test cycles

//! > test_function_name
test_function_diagnostics

//! > comments
// TODO(spapini): Make better diagnostics.

//! > function
fn foo() {
    let mut q = queue_new();
    queue_append(q, q)
}

//! > function_name
foo

//! > module_code

//! > expected_diagnostics
error: ref argument must be passed with a preceding 'ref'.
 --> lib.cairo:3:18
    queue_append(q, q)
                 ^

error: Unexpected argument type. Expected: "?0", found: "core::queue::Queue::<?0>".
 --> lib.cairo:3:21
    queue_append(q, q)
                    ^

error: Type annotation needed.
 --> lib.cairo:2:17
    let mut q = queue_new();
                ^*******^

//! > ==========================================================================

//! > Test undetermined system

//! > test_function_name
test_function_diagnostics

//! > function
fn foo() {
    let mut q = queue_new();
}

//! > function_name
foo

//! > module_code

//! > expected_diagnostics
error: Type annotation needed.
 --> lib.cairo:2:17
    let mut q = queue_new();
                ^*******^

//! > ==========================================================================

//! > Test type mismatch

//! > test_function_name
test_function_diagnostics

//! > function
fn foo() {
    let mut q: felt = queue_new::<felt>();
}

//! > function_name
foo

//! > module_code

//! > expected_diagnostics
error: Unexpected argument type. Expected: "core::felt", found: "core::queue::Queue::<core::felt>".
 --> lib.cairo:2:23
    let mut q: felt = queue_new::<felt>();
                      ^*****************^

//! > ==========================================================================

//! > Test never type

//! > test_function_name
test_function_diagnostics

//! > function
fn foo() -> felt {
    panic(queue_new())
}

//! > function_name
foo

//! > module_code

//! > expected_diagnostics

//! > ==========================================================================

//! > Test anti never type

//! > test_function_name
test_function_diagnostics

//! > function
fn foo() -> never {
    5
}

//! > function_name
foo

//! > module_code

//! > expected_diagnostics
error: Unexpected return type. Expected: "core::never", found: "core::felt".
 --> lib.cairo:1:19
fn foo() -> never {
                  ^

//! > ==========================================================================

//! > Test trait inference.

//! > test_function_name
test_function_diagnostics

//! > function
fn foo() {
   MyTrait::foo(5);
   MyTrait::foo(true);
   MyTrait::foo(Option::None(()));
}

//! > function_name
foo

//! > module_code
trait MyTrait<T> {
   fn foo(x: T);
}
impl MyImpl1 of MyTrait::<felt> {
   fn foo(x: felt) {}
}
impl MyImpl2 of MyTrait::<bool> {
   fn foo(x: bool) {}
}
impl MyImpl3 of MyTrait::<Option::<felt>> {
    fn foo(x: Option::<felt>) {}
 }

//! > expected_diagnostics

//! > ==========================================================================

//! > Test trait inference failures.

//! > test_function_name
test_function_diagnostics

//! > function
fn foo() {
   MyTrait::foo(5);
   MyTrait::foo(true);
   MyTrait::foo(Option::<felt>::None(()));
   MyTrait::foo(Option::None(()));
}

//! > function_name
foo

//! > module_code
trait MyTrait<T> {
   fn foo(x: T);
}
impl MyImpl1 of MyTrait::<felt> {
   fn foo(x: felt) {}
}
impl MyImpl2 of MyTrait::<felt> {
   fn foo(x: felt) {}
}
impl MyImpl3 of MyTrait::<Option::<felt>> {
    fn foo(x: Option::<felt>) {}
}
impl MyImpl4 of MyTrait::<Option::<bool>> {
    fn foo(x: Option::<bool>) {}
}

//! > expected_diagnostics
error: Trait `test::MyTrait` has multiple implementations, in: "test::MyImpl1", "test::MyImpl2"
 --> lib.cairo:17:4
   MyTrait::foo(5);
   ^*************^

error: Trait `test::MyTrait::<?1>` has no implementation in the context.
 --> lib.cairo:18:4
   MyTrait::foo(true);
   ^****************^

error: Trait `test::MyTrait` has multiple implementations, in: "test::MyImpl3", "test::MyImpl4"
 --> lib.cairo:20:4
   MyTrait::foo(Option::None(()));
   ^****************************^

error: Type annotation needed.
 --> lib.cairo:20:17
   MyTrait::foo(Option::None(()));
                ^****^
